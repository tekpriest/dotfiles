#!/bin/bash

set-option -g detach-on-destroy off # don't destroy session on detach
# set-option -g default-terminal "xterm-kitty"
# set-option -sa terminal-features ",xterm-kitty:RGB"
# set-option -g default-terminal "tmux-256color"
set-option -g default-terminal "tmux-256color"
set-option -sa terminal-features ",xterm-256color:RGB"


setw -g xterm-keys on

# base settings
# set -g default-terminal "alacritty"
set -g base-index 1
set -g pane-base-index 1
set -g clock-mode-style 24
set -g focus-events on
set -g history-limit 1000000
set -g renumber-windows on
set -g set-clipboard on
set -g status-keys vi
set -gs escape-time 0
set -gs repeat-time 600
set -g mouse on
setw -g automatic-rename on
# set -g automatic-rename-format "#{?#{==:#{pane_current_command},zsh},#{b:pane_current_path},#{pane_current_command}}"
set -g status-interval 1
# set -g set-titles on
# set -g monitor-activity on
set -g status-left "#[fg=blue,bold]#S #[fg=yellow,bold]#(gitmux -cfg $HOME/.tmux/gitmux.conf) "
set -g status-right '#[fg=yellow,bg=default]%a, #[fg=yellow,bg=default]%d %b #[fg=white,bg=default]%H:%M:%S '
set -g status-left-length 200 # increase length (from 10)
set -g status-position top    # macOS / darwin style
# set -g status-right-length 20 # decrease length (from 10)
set -g status-style 'bg=default'
set -g window-status-current-format '#[fg=magenta]#W'
set -g window-status-format '#[fg=gray]#W'
set -g message-command-style 'bg=default,fg=yellow'
set -g message-style 'bg=default,fg=yellow'
set -g mode-style 'bg=default,fg=yellow'
set -g pane-active-border-style 'fg=magenta,bg=default'
set -g pane-border-style 'fg=brightblack,bg=default'
# dim inactive windows
setw -g window-style 'fg=colour245'
setw -g window-active-style 'fg=colour15'

unbind C-b
set -g prefix C-a
bind-key C-a send-prefix

# splitting
unbind %
unbind '"'
bind | split-window -c '#{pane_current_path}' -h
bind - split-window -c '#{pane_current_path}' -v

# run commands
bind c new-window -c '#{pane_current_path}'
bind g new-window -n ' ' lazygit
bind G new-window -n ' ' gh dash
bind t new-window -n ' ' -c '#{pane_current_path}'

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind -r f resize-pane -Z # toggle fullscreen

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'v' send-keys -X begin-selection
# bind-key x kill-window # skip "kill-pane 1? (y/n)" prompt (cmd+w)

# reloading config
unbind r
bind r source-file ~/.tmux.conf \; display "reloaded ~/.tmux.conf"

# resize panes with uppercase keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5


# use clear instead of C-l
# bind C-l send-keys C-l \; clear-history

# vi mode
set-window-option -g mode-keys vi

bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

unbind -T copy-mode-vi MouseDragEnd1Pane

# Toggle popup window with Alt-3
# bind-key f display-popup -E 'tmux attach-session -t #{pane_current_path}-popup || tmux new-session -s #{pane_current_path}-popup'

# open sessions all collapsed
unbind w
bind w choose-tree -sw

# Disable confirmation
bind-key x kill-pane
bind-key X kill-window
bind-key q kill-session
bind-key Q kill-server

# break pane into a window
bind = select-layout even-vertical
bind + select-layout even-horizontal
# bind - break-pane
bind _ join-pane

# fzf find binding
set -g @t-fzf-find-binding 'ctrl-f:change-prompt(  )+reload(fd -H -d 2 -t d . ~)'

# tpm plugin
set -g @plugin 'tmux-plugins/tpm'

# plugins
set -g @plugin 'joshmedeski/tmux-nerd-font-window-name'
set -g @plugin 'joshmedeski/t-smart-tmux-session-manager'
set -g @plugin 'joshmedeski/tmux-fzf-url'
set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'olimorris/tmux-pomodoro-plus'

# t-smart-tmux-session-manager
set -g @t-fzf-prompt '  '
set -g @t-bind "s"
set -g @fzf-url-fzf-options '-p 60%,30% --prompt="   " --border-label=" Open URL "'
set -g @tmux-nerd-font-window-name-show-name false
set -g @tmux-nerd-font-window-name-shell-icon ''
set -g @fzf-url-history-limit '2000'

# initialize tmux manager
run "$HOME/.tmux/plugins/tpm/tpm"
